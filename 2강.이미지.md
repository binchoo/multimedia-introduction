# Image Representation

## 이미지 관련 용어
### 화소(pixel) 

### 비트맵(bitmap) 
: 그림을 구성하는 요소인 픽셀(점)들의 색정보(밝기)값을 나열한 파일

### 해상도(resolution) 
: 디지털 이미지에 포함되어 있는 픽셀의 개수, 그러나 가로, 세로의 화소길이 정보를 알 수 없다.  그러므로 (가로x세로) 형태로 표현해 준다. 
- 가로에 4K개의 픽셀이 있는 화면해상도를 4K UHD라 부를 수 있다.
- 2160 * 2 인 화면의 해상도를  4K UHD라고 하기도 한다.

### 화면비(aspect ratio) 
: 일반적으로 4:3비율이 많이 사용되었다. 그러나 영화에는 제한적인 비율이여서 와이드 스크린을 적용하게 되었는데, 이 영화를 4:3 컴퓨터 화면에서 시청하게 되면 비율이 맞지 않아 영상이 훼손되어 보이므로, 다른 기기도 와이드스크린을 많이 사용하게 되었다.



## 그레이 스케일 이미지

### 하프톤 프린팅(half-tone printing)
: 신문을 인쇄할 때 사용하던 기법임. 검은색 잉크로 회색조를 표현하기 위해 크고 작은 원들을 찍어서 표현하였다. 요즘 기술에선 원을 사용하진 않는다.

### 1-bit 픽셀 이미지
: 진정한 블랙 & 화이트. 한 픽셀의 정보가 1비트로 표현된다. 0이면 색 없음, 1이면 색 있음.

### 8-bit, 256레벨 그레이 스케일 이미지
: 각 픽셀이 8비트의 정보로 표현된다. 0(검정) ~ 255(흰색)을 표현.

### 그레이 스케일 이미지를 프린트 하기
검은점을 어느 정도의 밀도로 찍는가에 따라 회색의 수준을 표현할 수 있다. DPI는 인치 당 점의 개수이며 프린터의 해상도임.

- **패터닝(patterning)** :  컴퓨터 화면과 프린트의 해상도차이 때문에 프린터에서 작게 출력된다. 그리고 프린터는 1-bit 픽셀 프린터이기 때문에 그레이 스케일을 일대일로 표현할 수 없다. 그래서 N by N 공간에 픽셀을 인쇄하여 크기를 확장한다. 원본 픽셀의 그레이스케일이 NxN 1-bit 픽셀 공간으로 매핑될 때 어떻게 될지 평가한다. 이 열화된 그레이스케일과 대응되는 점 패턴이 종이에 프린트 된다. 이 패턴은 픽셀의 그레이스케일에 따라 미리 디자인 된 *칠하기 패턴(binary font)* 이다. 예를 들어, 8-bit 픽셀의 점 하나가 3x3 공간에 매핑된다면 256수준의 그레이스케일이 10수준 그레이스케일로 열화되므로, 256 / 10 = 25.6 단위 수준에 따라 각각 0 부터 9까지의 폰트를 사용하면 된다.
- **디더링** : 디더링은 바이너리 폰트를 사용하지 않고,  NxN 크기의 디더링 매트릭스를 사용한다. 이 매트릭스 각각의 원소값과 열화된 그레이스케일을 비교한다. 디더링 매트릭스의 원소값보다 그레이스케일 값이 크면 NxN 픽셀공간의 대응되는 위치에 점을 찍는다. 
- 프린트되는 **이미지의 크기가 커지지 않길 바란다면** : **오더드 디더링**을 사용한다. 원본 이미지의 그레이스케일을 열화 그레이스케일로 평가한다. 그리고 디더링 매트릭스를 슬라이더로 사용해서 이미지 위에 얹는다고 생각해보자. 매트릭스와 겹친 부분의 그레이스케일 값이 해당 위치의 원소 값보다 크다면 점을 찍는다.

## 컬러 이미지

### 24-bit 컬러 이미지

: RGB각각 8비트 = 3바이트로 색상 표현. 256x256x256개의 색상 표현이 가능하다(트루컬러). 4바이트 중 **남은 한 바이트는 알파채널**, 즉, 투명도를 나타내는 값이 들어갈 수 있다.

### 8-bit 컬러 이미지 (압축을 하지 않고 용량을 줄이기)

: 256개의 색상을 갖는다. 컬러 팔레트 혹은, 컬러 룩업 테이블(**LUT**)이라고 하는, 3바이트 짜리 트루컬러 중 256개를 선정하여 집어 넣는 테이블의 256개 인덱스로 색을 지정한다. 그렇다면 테이블의 크기는 3x256바이트이다. 256개 컬러는 사용자가 원하는 대로 설정할 수 있으며, 이미지 파일 안에다가 LUT을 저장해서 보내줘야 한다.

-  컬러 룩업 테이블(팔레트) 만들기 :
   -  Median-cut 알고리즘 : (**책**) B는 사람 눈에 덜 중요하므로 RGBRGB**RG** 축 순서로, 그 축에서 중위수에 해당하는 스케일을 기준으로 컬러 스캐터를 나눈다. 중위수보다 큰 집합은 1, 작은 집합은 0으로 레이블한다. 이 값은 LSB서부터 차곡차곡 쌓여서(총 8bit) 해당 집합 대표색의 LUT 테이블 인덱스 번호가 될 것이다. (**더 정확한 방법**) 범위가 가장 긴 축을 기준으로 컬러 스캐터를 나눈다.

## BMP 파일 구조

: 비트맵은 픽셀 값의 나열일 뿐이므로 디바이스마다 이미지가 일정하지 않게 다른 모습으로 표현 될 수 있다. 그러나! Device Independent Bitmap 파일은 이 문제를 해결한다. 윈도우의 .bmp파일은 바로 디바이스 인디펜던트 비트맵 파일이다. 

| **비트맵 파일 구조**                                         |
| ------------------------------------------------------------ |
| 비트맵 파일 헤더                                             |
| 비트맵 정보 헤더 -> 디바이스 독립을 위한 부가정보가 여기있다 |
| RGB QUAD 배열 (컬러 팔레트)                                  |
| color/index 배열 (픽셀 자료, 비트맵 자료)                    |

### 1. BMP FILE HEADER

- Type (2바이트)
  - 0x42 0x4d 로 시작함. = BM
  - 혹은 OS/2에서 정의한 플래그 두 글자 (deprecated) : OS/2는 IBM이 만든 무거운 운영체제
- Size (4바이트)
  - 비트맵 파일의 용량
- 예약된 공간 (4바이트) : 안 쓰임
- 오프셋 (4바이트) : 픽셀 자료가 어디서 시작하는 지

### 2.  BMP INFO HEADER

- Size (4바이트) : 비트맵 헤더의 용량 = 기본 40
- Width, Height (4+4 바이트) : 비트맵 이미지의 가로, 세로 길이
- Plane (2바이트) : 항상 1
- BitCount (2바이트) : 픽셀 당 비트의 수를 지시함 0x8, 0x18
- Compression (4바이트) = 압축을 안 쓰므로 0
- ImageSize(4바이트) : 픽셀 자료의 용량
- 1미터당 가로 픽셀의 개수 , 1미터당 세로 픽셀 개수 (각자 4B) : 이 정보로 사용자가 원하는 해상도를 디바이스 관련 없이 유지할 수 있음.
- NumColors (4B) = 0(트루컬러), 256(256개의 컬러)
- NumImportant = 아무 의미 없는 디자인ㅋ, deprecated, NumColor값과 같이 해 놓음.

### 3. COLOR PALETTE
 - 256개 인덱스로 지시하는 컬러 룩업 테이블이다.
 - 하나의 엔트리는 **4바이트** 정보이다.
    	- **B/G/R** 순서의 트루컬러 정보와 예약된 1바이트 공간
- **그레이스케일일 경우** 256수준의 회색 색상을 담는다.

### 4. PIXEL DATA

- 우하향이 아니라 우상향 방향의 픽셀정보를 저장한다.
- 컬러픽셀의 경우 한 픽셀 당 3바이트 씩
- 그레이스케일인 경우 한 픽셀 당 1바이트 씩

- 4 units alignment

### 5. 비트맵 파일 구현해보기

- *size*는 16바이트로 나눈 줄 수를 세면 금방 계산할 수 있다.
- 그레이스케일의 *size* 는 00 04 이상일 수 밖에 없다. (256 엔트리 * 4)
- 그레이스케일의 컬러테이블은 256 수준의 회색들이다
- 8비트 컬러의 컬러테이블은 선택된 256 컬러이다.
- *header size* = 40 = 0x28
- *bitcount* 트루컬러 24  = 0x18, 8비트 컬러/그레이 스케일 = 0x08
- 트루컬러의 *픽셀 당 용량* = 3바이트/  8비트 및 그레이스케일 = 1바이트

## GIF87 파일 구조

- 느린 회선속도에서 이미지를 주고받으려면 압축된 이미지 포맷이 필요하다.

- 픽셀 데이터 부분은 ***LZW*** 압축된다.

- 트루컬러를 지원하지 않는 ***8비트* 컬러 포맷**이다.

- ***인터레이싱***을 통해 4-pass에 픽셀을 보내서 점점 선명해지도록 만든다.

- 딜레이를 부여해서 ***애니메이션*** 기능을 구현한다.

|               GIF87a 시그니쳐               |
| :-----------------------------------------: |
| 스크린 디스크립터 : 전체 이미지에 대한 속성 |
|               컬러맵(글로벌)                |
|              이미지 디스크립터              |
|              컬러맵(이미지용)               |
|                  픽셀정보                   |
|               GIF TERMINATOR                |

### 1. SIGNITURE

GIF87a

### 2. SCREEN DESCRIPTOR

- 크기 : 각각 2바이트. 가로 세로의 길이
- m플래그 :  글로벌 컬러테이블이 있는지 표시한다.
- cr플래그 : 3비트(0~7). 컬러 해상도를 의미함.     +1 해야한다.
- x
- pixel : 3비트(0~7). 한 픽셀을 위해 몇 비트를 사용하는지     +1 해야함
- 백그라운드 : 1바이트. 남은 배경 영역 색깔
- 00000000

### 3. GLOBAL COLOR MAP

- 전역 혹은 이미지 전용 컬러맵
- R/G/B **3바이트**의 나열이다.
- 길이는 2^(pixel+1)

### 4. IMAGE DESCRIPTOR

- 콤마(00101100) : 이미지 구분자
- Image Left/Top/Width/Height : 각 2바이트. 리틀엔디안. 스크린 상 이미지의 위치
- m플래그 : 로컬 컬러맵이 있는지 = 1
- i플래그 : 인터레이싱 적용 하는지 = 1
- xxx
- pixel

### 5. LOCAL COLOR MAP

### 6. RASTER AREA

- LZW 압축된 인덱싱 정보

### 7. EOF

###  인터레이싱

- pass1 : 8행씩 건너뛰며 행 전시, 이게 끝나면...
- pass2 : 8행씩 건너뛰며 행 전시, 이게 끝나면...
- pass3 : 4행씩 건너뛰며 행 전시, 이게 끝나면...
- pass4 : 2행씩 건너뛰며 행 전시

## GIF89

- *딜레이* : 이전 버전에서는 컴퓨터 버전에 따라 이미지가 휘리릭 전환되지만 89에서는 딜레이에 의해 전환된다.
- *transparency*
- *컬러테이블 소팅* : 컬러 중요도를 표시... **근데 이게 뭔 의미??**

## JPEG

- spatial frequency, 픽셀 양자화 : 인간 시각의 한계를 이용하여 손실 압축을 실현한다. 눈에 안 띄는 정보를 날려버림. 압축률 UP

## PNG

- GIF 기반 : GIF 특허 로열티를 비껴가기 위해
- 48비트 컬러 (픽셀당 16비트) 지원
- 2차원 블록 (8x8) 기준으로 인터레이싱

## TIFF

- 무손실
- 태그를 달아서 여러가지 포맷을 한 데 쌓아 놓은 형태이다

## EXIF 

- 디지털 카메라용 포맷
- 사진을 찍었을 때 정보를 태그로 담고 있다. 메타 데이터

## PS, PDF

- 레이저프린터에서 사용하던 언어
- ,LZW 압축