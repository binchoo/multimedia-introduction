# JPEG 압축

역사 : 1992, 1993년도에 발표한 표준

## 아이디어

1. 일반적인 영상은, 공간 내에서 변화가 급격하지 않다. 특히 좁은 영역에서 밝기 값이 급격하게 변하는 경우는 거의 없다. 
   - **Spatial Redundancy가 존재한다**
2. 높은 공간주파수 성분의 손실보다는, 낮은 공간주파수 성분의 손실에 민감하다.
   - 낮은 공간주파수의 가중치가 상대적으로 중요하다
   - **공간주파수가 높으면 양자화 구간을 넓게 잡고, 주파수가 낮으면 구간을 작게 잡자**
3. 사람은 크로마보다 루마에 더 민감하다
   - 그러므로 4:2:0 크로마 서브 샘플링을 한다

이렇게 해서 이미지의 압축률을 높이자!!

## JPEG 단계

1. RGB => YIQ YUV YCbCr 루미넌스와 크로마로 나눌 수 있는 컬러모델로 변환하고 -127 ~ 128 수준으로 나타낸다

2. 크로마를 서브샘플링 한다. **보통 4:2:0**

3. 영상을 8x8 영상 블록들로 쪼개서 2D DCT를 진행한다

4. 양자화를 한다

   1. 고주파 성분을 위해 적은 비트로 양자화 구간을 넓게 잡는다
   2. 저주파 성분을 위해 많은 비트를 사용하여 양자화 구간을 좁게 잡는다
   3. 나중 수준 = 기존 수준 * (양자화 수준 수 / 기존 수준 수)

   ex) 현재 값이 200이고 256 수준이 있다. 10 수준으로 나타내면? 200 * (10 / 256) = 9 수준

   양자화에 의한 오차의 최대치는? 델/2

5. AC Zig zag Run-Length와 DC DPCM을 진행

   1. x와 y가 고주파로 다가가는 속도를 맞추자
   2. 고주파로 갈수록 0이 몰려나올 확률이 높다
   3. Run-Length 코딩을 할 때 지그재그를 쓰는 것이 더 유리하다 
   4. DC 성분은 이전 블록 DC성분과 차분하여 인코딩한다.

6. 코드 테이블을 보고 Entropy Coding 한다.

   1. **SSS = 부호화에 필요한 비트 수**

## JPEG Modes

JPEG 파일을 수신 받다가 네트워크가 끊기게 되면 영상의 받은 부분까지는 컬러가 살아있음

Y, Cb, Cr 순서로 영상이 수신된다면 66% 정도 받았을 때까지 흑백으로 보이고 

이후 파란 계통과 붉은 계통이 표시된다.

### Sequential / Default Mode

- 4:2:0 이면 Y블락 4개에 대해서 Cb블락 하나와 Cr블락 하나 비율로 존재한다. 
- 그래서 이들 6개의 블럭을 전달하면 컬러 정보가 모두 살아있다.
- **Minimun Coded Unit** : 6가지 블럭 단위를 말한다. 이 단위로 전송되어야 컬러정보가 살기 때문이다
- **즉, 전송위 단위는 MCU = 4개의 8\*8블락**

### Progressive Mode

영상이 뿌연 상태에서 점차 선명해지는 모습을 본 적이 있을 것임

- 오래 기다리기 싫으니까 처음엔 대충이라도 볼 수 있게

- 점진적으로 좋은 화질이 되도록

  - Spectral Selection

    고주파 성분이 없을 때 사진이 뿌옇다

    저주파 성분 ~ 고주파 성분 순으로 전송하면 점진적으로 선명한 영상이 된다

  - Successive Approximation

    1,123,213 = "백 만원" / "백 십 만원" / "백 십 이 만원"

    Most Significant 부터 구체적으로 선택해 나가면 점점 수치가 구체화 된다

    JPEG전송에 적용할 때는 **Most Significant Bit 부터 차례로 보내면 된다**


### Hierarchical Mode

종류가 다양한 디스플레이는 해상도가 다 다르다. 그렇다고 해서 송신 측 입장에서 각 디스플레이가 요구하는 영상을 송출해야 할 까?

- 추가정보와 함께 영상을 전달

- 추가정보를 참고해서 보내준 영상에서 원하는 해상도의 영상을 뽑아내도록 한다.

- 고해상도 영상이 필요없다면 **보여주진 않더라도 저장은 할 수 있다**
- 인코더 디코더 복잡하고 큰 해상도 복원하려면 순서를 기다려야 해서 안 쓰인다







RGB나 CLUT를 사용하면 압축률은 좀 떨어진다. 그러나 JPEG에 사용이 가능함!

- RGB는 JPEG에서 사용이 **가능**하다

MCU 단위로 보내다가 영상이 깨지게 되었을 때

- 영상을 세그먼트로 나누었기 때문에 다른 세그먼트는 영향 안 받음

